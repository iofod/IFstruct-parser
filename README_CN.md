# IFstruct 解析器

[![Version](https://img.shields.io/github/package-json/v/iofod/IFstruct-parser)](https://github.com/iofod/IFstruct-parser/)
[![NPM](https://img.shields.io/npm/v/iofod-cli)](https://www.npmjs.com/package/iofod-cli)
[![Build Status](https://img.shields.io/github/workflow/status/iofod/IFstruct-parser/build)](https://github.com/iofod/IFstruct-parser/actions)
[![License](https://img.shields.io/github/license/iofod/IFstruct-parser)](https://github.com/iofod/IFstruct-parser/blob/main/LICENSE.md)

解析器用于将 IFstruct 解析成可执行代码，同一份 IFstruct，不同解析器生成的代码工程不同，开发者可直接使用生成的工程项目或者进行二次开发定制。

## 官方解析器

官方团队目前提供了 Web，小程序和 Flutter 三套解释器和基本的 CLI 命令行工具，配合 iofod 拓展 **IFstruct 同步** 使用，即可支持将 IFstruct 解析成对应技术栈工程源码。

## 使用解析器

如果无需自定义解析规则，可直接全局安装 npm 上的包：

```bash
npm install iofod-cli -g
```

否则，从 Github 下载或克隆项目完成后进入项目目录，先执行命令安装 CLI 到全局：

```bash
npm run cli:install
```

安装完成后即可在命令行执行 `iofod` 相关命令。

### Web 解析器

通过 Web 解析器可以将 IFstruct 解析成 Web 工程源码，官方采用 [Vue](https://vuejs.org/) 作为 Web 工程框架。

1. 创建 iofod 命令创建 Web 工程模板：

```bash
iofod create --temp web --dir MyWebProject
```

2. 进入工程目录，添加 IFstruct 监听器：

```bash
cd MyWebProject && iofod listen --port 3001
```

3. 启动 iofod 拓展区 **IFstruct 同步** 拓展，将同步源选项配置为：`ws://127.0.0.1:3001`，后开启**启动同步**即可监听当前项目内容变更并将 IFstruct 增量同步到监听器，自动生成工程代码。

4. 在工程目录执行依赖安装，安装完成后即可运行 npm 脚本进行开发预览：

```bash
npm run dev
```

浏览器下预览调试：

![](https://doc.iofod.cn/public/zh-cn/cn-605-3v1.jpg)

### 小程序解析器

通过小程序解析器可以将 IFstruct 解析成小程序工程源码，官方采用 [Taro](https://taro.jd.com/) 作为小程序工程框架。（支持微信小程序、京东小程序、百度小程序、支付宝小程序、字节跳动小程序、QQ轻应用和快应用）


1. 创建 iofod 命令创建小程序工程模板：

```bash
iofod create --temp mp --dir MyMpProject
```

2. 进入工程目录，添加 IFstruct 监听器：

```bash
cd MyMpProject && iofod listen --port 3002
```

3. 在**IFstruct 同步**拓展的同步源配置中加入`ws://127.0.0.1:3002`，重新启动同步即可同步监听器生成工程代码。

4. 在工程目录执行依赖安装，安装完成后即可运行 npm 脚本进行开发预览：

```bash
npm run dev:weapp
```

微信开发者工具下预览调试：

![](https://doc.iofod.cn/public/zh-cn/cn-605-2.jpg)

### Flutter 解析器

通过 Flutter 解析器可以将 IFstruct 解析成 Flutter 工程源码，官方采用 [Flutter](https://flutter.dev/) 作为移动端应用工程框架。

1. 创建 iofod 命令创建 Flutter 工程模板：

```bash
iofod create --temp flutter --dir MyFlutterProject
```

2. 进入工程目录，添加 IFstruct 监听器：

```bash
cd MyFlutterProject && iofod listen --port 3003
```

3. 在**IFstruct 同步**拓展的同步源配置中加入`ws://127.0.0.1:3003`，重新启动同步即可同步监听器生成工程代码。


4. 在工程目录执行依赖安装，安装完成和配好环境后，点击IDE调试按钮进行开发预览：

![](https://doc.iofod.cn/public/zh-cn/cn-605-4.jpg)

或者执行 flutter 命令进行开发预览：

```bash
flutter run -d <deviceId>
```

模拟器下预览调试：

![](https://doc.iofod.cn/public/zh-cn/cn-605-1v1.jpg)

### 拓展开发模板

iofod SDK 提供开发者在 Web worker 里与 iofod 主界面交互的能力，通过 SDK 来快速开发 iofod 拓展。IFstruct 命令行工具集成了 iofod 拓展开发模板：

```bash
iofod create --temp extension --dir MyExtensionProject
```

拓展开发详细文档请阅读[官方文档](https://doc.iofod.cn/#/zh-cn/9/01)。

### IFstruct 同步 拓展

拓展操作可参照：[界面指南 - 使用拓展](https://doc.iofod.cn/#/zh-cn/3/24) ，在添加拓展面板搜索**IFstruct 同步**，点击搜索结果进入拓展详情页，安装完拓展后回到拓展管理面板，为该拓展设置**快捷启动**后即可在 iofod 拓展区看到拓展图标。

点击启动拓展，填写同步源地址后（回车分隔），开启**启动同步**即可将 IFstruct 推送到目标地址。

![](https://doc.iofod.cn/public/zh-cn/cn-605-5.jpg)

### 定制解析器

官方提供的解析器涵盖了大部分主流应用开发的形式，开发者只需对解析器模板进行微调即可适配多数业务需求，假如官方解析器满足不了需求，开发者可以自行发挥创造力，需改或重写更合适的解析器。

